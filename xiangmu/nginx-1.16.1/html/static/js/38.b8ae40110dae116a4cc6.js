webpackJsonp([38],{ieRx:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("pFYg"),i=o.n(s),a=o("BO1k"),n=o.n(a),r=o("7t+N"),l=o.n(r),d={name:"lookDetail",data:function(){return{loading:!1,roler:"all",book:{},bookId:"",catloge:[],props:{label:"title",children:"children"},count:0,bookCatalogResource:"",parentId:0,catlogId:"",catlogTitle:"",modifyTitle:"",authors:"",keyWords:"",articles:[],articlesIds:[],dialogVisible:!1,publishDate:"",articleResource:[],curNode:"",curMethod:"",nodeIds:[],ordering:!1,newWd:"",isNewWd:!1,catlogIds:[],checkedNodes:[],bookheight:"",treeheight:""}},filters:{publishDateFtt:function(e){return e?(e=e.toString()).split("-")[0]+"年"+e.split("-")[1]+"月":""}},components:{loadingTip:o("T8Lg").a},methods:{showKeyWd:function(){var e=this;this.isNewWd=!0,this.newWd="",this.$nextTick(function(){e.$refs.inputFocus.focus()})},updateKeyWd:function(){this.isNewWd=!1,""!=this.newWd.trim()&&(this.keyWords=this.keyWords.length>0?this.keyWords+";"+this.newWd:this.newWd)},handleNodeClick:function(e,t,o){this.catlogId=e.id,this.catlogTitle=e.title,this.modifyTitle=e.title,this.getCont()},addChapter:function(){this.checkedNodes=[];var e=this.$refs.catelogTree.getCheckedNodes();if(this.checkedNodes=this.$refs.catelogTree.getCheckedNodes(),e.length>0){var t=!0,o=!1,s=void 0;try{for(var i,a=n()(e);!(t=(i=a.next()).done);t=!0){var r=i.value;this.catlogIds.push(r.id)}}catch(e){o=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(o)throw s}}this.addArtical()}else this.$message.error("请先选择章节！")},addArtical:function(){var e=this;e.ordering||(e.ordering=!0,e.$http({method:"post",url:"/admin/cms/bookcatalogresource/join",data:{ids:e.catlogIds,title:e.modifyTitle,keywords:e.keyWords},transformRequest:[function(e){var t="";for(var o in e)t+=encodeURIComponent(o)+"="+encodeURIComponent(e[o])+"&";return t}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){if(0==t.data.code){e.$message.success("加入成功！");var o=!0,s=!1,i=void 0;try{for(var a,r=n()(e.checkedNodes);!(o=(a=r.next()).done);o=!0){var l=a.value;l.status=1,l.disabled=!0}}catch(e){s=!0,i=e}finally{try{!o&&r.return&&r.return()}finally{if(s)throw i}}}else e.$message.error(t.data.msg);e.ordering=!1,e.dialogVisible=!1}))},loadNode:function(e,t){var o=this;e.data&&(o.parentId=e.data.id),o.$http({method:"get",url:"/admin/cms/bookresource/catalog",params:{resourceId:o.bookId,parentId:o.parentId},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){0==o.count&&(o.count=1,o.handleNodeClick(e.data.list[0])),t(e.data.list)})},getCont:function(){var e=this;e.loading||(e.loading=!0,e.bookCatalogResource="",e.$http({method:"get",url:"/admin/cms/bookcatalogresource/info",params:{id:e.catlogId},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){e.bookCatalogResource=t.data.bookCatalogResource,t.data.articleResource&&(e.articleResource=t.data.articleResource),e.loading=!1,setTimeout(function(){for(var e=document.getElementsByClassName("note"),t=0;t<e.length;t++)e[t].innerHTML='<font style="color:red">'+(t+1)+"</font>";window.tip={Tips:function(e){return"object"==(void 0===e?"undefined":i()(e))?e:"string"==typeof e||"number"==typeof e?document.getElementById(e.toString()):null},mousePos:function(e){return{x:(e=e||window.event).clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:e.clientY+document.body.scrollTop+document.documentElement.scrollTop}},start:function(e){var t=this,o=t.Tips("mjs_tip");e.onmousemove=function(s){var i,a=t.mousePos(s),n=a.x-220-270,r=a.y-110+50;o.style.left=n+"px",o.style.top=r+"px",o.innerHTML="注：",i=e.getAttribute("tips"),o.appendChild(document.createElement("div")).innerHTML=i,o.style.display="";var d=r+o.clientHeight-l()(window).height()-l()(window).scrollTop(),c=n+o.clientWidth-l()(window).width()-l()(window).scrollLeft();d>0&&(r=r-d-2,o.style.top=r+"px"),c>0&&(n=n-c-2,o.style.left=n+"px")},e.onmouseout=function(){o.style.display="none"}}}},500)}))},getBookMsg:function(){var e=this;e.$http({method:"get",url:"/admin/cms/bookresource/info/"+e.bookId,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){e.book=t.data.bookResource,e.book.keyWordCn&&""!=e.book.keyWordCn&&(e.book.keyWordCn=e.book.keyWordCn.split(";")),setTimeout(function(){var t=document.getElementById("bookMsg").clientHeight;e.bookheight=document.body.clientHeight-170,e.treeheight=document.body.clientHeight-t-170},500)})}},created:function(){this.bookId=this.$route.query.id,this.parentId=0,this.getBookMsg()}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"rt_cont"},[o("div",{staticStyle:{padding:"10px 0",background:"#F0F2F5"}},[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{attrs:{to:{path:"/main/adminManageHome"}}},[e._v("首页")]),e._v(" "),o("el-breadcrumb-item",{attrs:{to:{path:"/main/bookManage"}}},[e._v("图书管理列表")]),e._v(" "),o("el-breadcrumb-item",[e._v("图书管理")])],1)],1),e._v(" "),o("div",{staticClass:"nrgl"},[o("div",{staticClass:"btnhandle"},[o("el-tabs",{model:{value:e.roler,callback:function(t){e.roler=t},expression:"roler"}},[o("el-tab-pane",{attrs:{name:"all"}},[o("span",{attrs:{slot:"label"},slot:"label"},[e._v("图书预览")]),e._v(" "),o("el-row",{staticClass:"content"},[o("el-col",{staticStyle:{"border-right":"1px solid #e5e5e5"},attrs:{span:18}},[o("div",{staticClass:"bookContent",style:{height:e.bookheight+"px"}},[o("loading-tip",{attrs:{"show-load":e.loading}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}]},e._l(e.articleResource,function(t,s){return o("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.articleResource.length,expression:"articleResource.length !=0"}]},[o("div",{staticStyle:{"text-align":"center",color:"#333","font-size":"16px","line-height":"32px",position:"relative","font-weight":"600"}},[o("div",{domProps:{innerHTML:e._s(t.title)}})]),e._v(" "),o("div",{staticClass:"cont",domProps:{innerHTML:e._s(t.content)}})])}))],1)]),e._v(" "),o("el-col",{attrs:{span:6}},[o("div",[o("div",{attrs:{id:"bookMsg"}},[o("div",{staticClass:"bookMsg"},[o("h3",{staticClass:"title"},[e._v("书名："),o("span",[e._v(e._s(e.book.title))])]),e._v(" "),o("p",{staticClass:"source"},[e._v("丛书名："),o("span",[e._v(e._s(e.book.seriesTitle))])]),e._v(" "),o("p",{staticClass:"source"},[e._v("出版日期："),o("span",[e._v(e._s(e._f("publishDateFtt")(e.book.publishDate)))])]),e._v(" "),o("p",{staticClass:"source"},[e._v("作者："),e._l(e.book.authorList,function(t){return o("span",{key:t.id},[e._v(e._s(t.name))])})],2),e._v(" "),o("div",{staticClass:"kwd"},[e._v("\n                                            关键词："),e._l(e.book.keyWordCn,function(t){return o("span",{key:t,staticClass:"keyWordCn"},[e._v(e._s(t))])})],2)]),e._v(" "),o("div",{staticClass:"catlog"},[e._v("图书目录")])]),e._v(" "),o("div",{staticClass:"treeLog",style:{height:e.treeheight+"px"}},[o("el-tree",{ref:"catelogTree",attrs:{data:e.catloge,props:e.props,"check-strictly":!0,load:e.loadNode,"highlight-current":!0,lazy:"","show-checkbox":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return o("div",{staticClass:"custom-tree-node"},[o("i",{directives:[{name:"show",rawName:"v-show",value:1==i.status,expression:"data.status==1"}],staticClass:"el-icon-star-on",staticStyle:{color:"#45AEC3"}}),o("span",{attrs:{id:i.id},domProps:{innerHTML:e._s(s.label)}})])}}])})],1)])])],1)],1)],1),e._v(" "),o("div",{staticClass:"upldbtn"},[o("a",{staticClass:"addResource aBtn",on:{click:e.addChapter}},[e._v("加入篇章管理")])]),e._v(" "),o("div",{staticClass:"tip",staticStyle:{position:"absolute",left:"0",top:"0",display:"none","word-break":"break-all"},attrs:{id:"mjs_tip"}}),e._v(" "),o("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("div",{staticClass:"tip_iterm"},[o("p",[e._v("标题：")]),e._v(" "),o("el-input",{attrs:{size:"small",placeholder:"请输入标题"},model:{value:e.modifyTitle,callback:function(t){e.modifyTitle=t},expression:"modifyTitle"}})],1),e._v(" "),o("div",{staticClass:"tip_iterm"},[o("p",[e._v("关键词：\n                        "),o("a",{directives:[{name:"show",rawName:"v-show",value:!e.isNewWd,expression:"!isNewWd"}],staticClass:"addKeyWd",on:{click:e.showKeyWd}},[e._v("+添加")]),e._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:e.isNewWd,expression:"isNewWd"}],ref:"inputFocus",staticStyle:{width:"200px"},attrs:{size:"small",autofocus:"autofocus",placeholder:"请输入关键词"},on:{blur:e.updateKeyWd},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?t.target.blur(t):null}},model:{value:e.newWd,callback:function(t){e.newWd=t},expression:"newWd"}})],1),e._v(" "),o("el-input",{attrs:{size:"small",placeholder:"请输入内容"},model:{value:e.keyWords,callback:function(t){e.keyWords=t},expression:"keyWords"}})],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("a",{staticClass:"aBtn aBtnCancle",on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),o("a",{directives:[{name:"show",rawName:"v-show",value:e.ordering,expression:"ordering"}],staticClass:"aBtn",attrs:{type:"primary"}},[o("i",{staticClass:"el-icon-loading"}),e._v("提交中")]),e._v(" "),o("a",{directives:[{name:"show",rawName:"v-show",value:!e.ordering,expression:"!ordering"}],staticClass:"aBtn",attrs:{type:"primary"},on:{click:e.addArtical}},[e._v("确 定")])])])],1)])])},staticRenderFns:[]};var u=o("VU/8")(d,c,!1,function(e){o("ylq6")},"data-v-6c994ddd",null);t.default=u.exports},ylq6:function(e,t){}});