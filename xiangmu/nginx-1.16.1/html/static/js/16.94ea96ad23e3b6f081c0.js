webpackJsonp([16],{"162o":function(e,t,a){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new n(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a("mypn"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,a("DuR2"))},AGa0:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("BO1k"),r=a.n(i),n=a("T8Lg"),s=a("NCg7"),o=a("162o"),l={name:"bookOrder",data:function(){return{loading:!1,showType:!1,title:"",newOrder:{},startYear:"",endYear:"",searchdate:"",multipleSelection:[],orderList:[],statusName:[{text:"草稿",value:"1"},{text:"已提交",value:"2"},{text:"待发布",value:"3"},{text:"发布中",value:"4"},{text:"已发布",value:"5"},{text:"审核未通过",value:"6"}],orderIds:[],total:0,curPage:1,limit:16}},components:{headerTop:s.a,loadingTip:n.a},methods:{handleSelectionChange:function(e){if(this.multipleSelection=e,this.orderIds=[],this.multipleSelection.length>0){var t=!0,a=!1,i=void 0;try{for(var n,s=r()(this.multipleSelection);!(t=(n=s.next()).done);t=!0){var o=n.value;this.orderIds.push(o.id)}}catch(e){a=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw i}}}},updateTimeFormat:function(e,t,a,i){if(a)return a.split(" ")[0]},clear:function(){this.searchdate="",this.title=""},lookDetail:function(e){this.$router.push({path:"/index/bookOrderDetail",query:{id:e.id}})},statusformat:function(e,t,a,i){var n=!0,s=!1,o=void 0;try{for(var l,c=r()(this.statusName);!(n=(l=c.next()).done);n=!0){var d=l.value;if(d.value==a)return d.text}}catch(e){s=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw o}}},handleCurrentChange:function(e){this.curPage=e,this.getMyOrder()},getMyOrder:function(){var e=this;e.loading=!0,e.$http({method:"get",url:"/admin/cms/resourcelist/mypage",params:{page:e.curPage,limit:e.limit,title:e.title,startDate:e.searchdate?e.searchdate[0]+" 00:00:00":null,endDate:e.searchdate?e.searchdate[1]+" 23:59:59":null,sidx:"create_time",order:"desc"},headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){0==t.data.code&&(e.orderList=t.data.page.records,e.total=t.data.page.total),e.loading=!1})},createOrder:function(){this.newOrder={},this.showType=!0},addNewOrder:function(){var e=this;e.$http({method:"post",url:"/admin/cms/resourcelist/save",data:e.newOrder,headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){0==t.data.code?(e.showType=!1,Object(o.setTimeout)(function(){e.getMyOrder()},500),e.$message.success("添加成功！")):e.$message.error("该资源单已经存在！")})},update:function(){1==this.multipleSelection.length?1==this.multipleSelection[0].status?this.$router.push({path:"/index/bookOrderDetail",query:{id:this.multipleSelection[0].id}}):this.$message.error("该状态不允许修改！"):this.$message.error("请选择一条数据")},submitOrder:function(){if(0!=this.multipleSelection.length){var e=!0,t=!1,a=void 0;try{for(var i,n=r()(this.multipleSelection);!(e=(i=n.next()).done);e=!0){if(1!=i.value.status)return void this.$message.error("只能选择草稿状态的资源！")}}catch(e){t=!0,a=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw a}}var s=this;s.$http({method:"post",url:"/admin/cms/resourcelist/submit",data:s.orderIds,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){0==e.data.code?(s.$message.success("提交成功！"),s.getMyOrder()):s.$message.error({message:e.data.msg,dangerouslyUseHTMLString:!0})})}else this.$message.error("请选择一条数据")}},created:function(){this.getMyOrder()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"crm"},[a("header-top"),e._v(" "),a("div",{staticClass:"order"},[a("div",{staticStyle:{padding:"6px 0"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),e._v(" "),a("el-breadcrumb-item",[e._v("我的书单")])],1)],1),e._v(" "),a("loading-tip",{attrs:{"show-load":e.loading}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}]},[a("div",{staticClass:"title"},[a("h3",[e._v("我的书单")]),e._v(" "),a("div",{staticClass:"searchBox fr"},[a("el-input",{staticClass:"inputWidth",attrs:{size:"mini",placeholder:"请输入书单名"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),a("el-date-picker",{staticStyle:{width:"280px"},attrs:{size:"mini",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"至","start-placeholder":"创建时间","end-placeholder":"创建时间"},model:{value:e.searchdate,callback:function(t){e.searchdate=t},expression:"searchdate"}}),e._v(" "),a("a",{staticClass:"aBtn ",on:{click:e.getMyOrder}},[e._v("搜索")]),e._v(" "),a("a",{staticClass:"aBtn aBtnCancle",on:{click:e.clear}},[e._v("重置")])],1)]),e._v(" "),a("div",{staticClass:"handle"},[a("div",{staticClass:"btnGroup clear-fix"},[a("a",{staticClass:"active",on:{click:e.createOrder}},[e._v("新增")]),e._v(" "),a("a",{staticClass:"active",on:{click:e.update}},[e._v("修改")]),e._v(" "),a("a",{staticClass:"active",on:{click:e.submitOrder}},[e._v("提交审核")])])]),e._v(" "),a("el-table",{ref:"multipleTable",staticClass:"tableWt",staticStyle:{width:"100%"},attrs:{data:e.orderList,"tooltip-effect":"dark",border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"书单编号",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"书单名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"总价",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态","column-key":"status",formatter:e.statusformat,width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"submitTime",label:"提交时间",formatter:e.updateTimeFormat,width:"140"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticStyle:{color:"#409EFF"},on:{click:function(a){e.lookDetail(t.row)}}},[e._v("查看")]),e._v(" "),4==t.row.status||5==t.row.status?a("span",[e._v("  "),a("a",{staticStyle:{color:"#409EFF"},attrs:{href:"/admin/cms/resourcelist/downLoadResource?resourceOrderId="+t.row.id}},[e._v("下载")])]):e._e()]}}])})],1),e._v(" "),a("div",{staticClass:"fr paginations"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next, jumper","current-page":e.curPage,"page-size":e.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.curPage=t}}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增书单",visible:e.showType,width:"30%"},on:{"update:visible":function(t){e.showType=t}}},[a("div",{staticClass:"add"},[a("p",[e._v("书单名称:")]),e._v(" "),a("el-input",{attrs:{size:"mini",placeholder:"请输入内容"},model:{value:e.newOrder.name,callback:function(t){e.$set(e.newOrder,"name",t)},expression:"newOrder.name"}}),e._v(" "),a("p",[e._v("书单说明：")]),e._v(" "),a("el-input",{attrs:{size:"mini",type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:e.newOrder.abstracts,callback:function(t){e.$set(e.newOrder,"abstracts",t)},expression:"newOrder.abstracts"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",[a("a",{staticClass:"aBtn aBtnCancle",on:{click:function(t){e.showType=!1}}},[e._v("取 消")]),e._v(" "),a("a",{staticClass:"aBtn ",attrs:{type:"primary"},on:{click:e.addNewOrder}},[e._v("确 定")])])])])],1)],1)},staticRenderFns:[]};var d=a("VU/8")(l,c,!1,function(e){a("eOR5")},"data-v-6ee43d40",null);t.default=d.exports},eOR5:function(e,t){},mypn:function(e,t,a){(function(e,t){!function(e,a){"use strict";if(!e.setImmediate){var i,r,n,s,o,l=1,c={},d=!1,u=e.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(e);m=m&&m.setTimeout?m:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){h(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=a,t}}()?e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){h(e.data)},i=function(e){n.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(r=u.documentElement,i=function(e){var t=u.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(h,0,e)}:(s="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&h(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),i=function(t){e.postMessage(s+t,"*")}),m.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var r={callback:e,args:t};return c[l]=r,i(l),l++},m.clearImmediate=p}function p(e){delete c[e]}function h(e){if(d)setTimeout(h,0,e);else{var t=c[e];if(t){d=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(a,i)}}(t)}finally{p(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,a("DuR2"),a("W2nU"))}});