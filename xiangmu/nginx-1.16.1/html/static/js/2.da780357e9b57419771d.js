webpackJsonp([2],{Xjf2:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("BO1k"),i=r.n(a),s=r("5g4Q"),o={name:"articalManage",data:function(){return{loading:!1,isbn:"",dialog:!1,resourceTip:!1,multipleSelection:[],curPage:1,limit:14,filteList:[{text:"已发布",value:"6"},{text:"取消发布",value:"7"}],isshow:!1,fileList:[],total:0,bookList:[],statusList:[],searchWord:"",author:"",sourceType:"",sidx:"",order:"desc",ids:[],userInfo:"",editorList:[],editor:"",roler:"all",resourceList:[],resourceOrderId:"",curType:"",permision:"",sourceArticle:"",isNewCreate:!1,newOrder:{},popTitle:"加入书单",startDate:"",endDate:"",typeCodeName:{chapter:"篇章",article:"文章",report:"报告",paper:"论文"},holdText:""}},watch:{$route:"init"},components:{loadingTip:r("T8Lg").a},mixins:[s.b],methods:{handleClick:function(t,e){this.curPage=1,this.getBookList()},search:function(){this.isshow=!this.isshow},clear:function(){this.searchWord="",this.startDate="",this.endDate="",this.isbn="",this.getBookList()},filterTag:function(t,e){return!0},lookDetail:function(t){"chapter"==this.curType&&this.$router.push({path:"/main/chaperArticalManage/chaperArticleDetail",query:{id:t.id,type:this.curType}}),"article"==this.curType&&this.$router.push({path:"/main/articalManage/lookArticleDetail",query:{id:t.id,type:this.curType}}),"paper"==this.curType&&this.$router.push({path:"/main/paperList/lookPaper",query:{id:t.id,type:this.curType}}),"report"==this.curType&&this.$router.push({path:"/main/reportList/lookReport",query:{id:t.id,type:this.curType}})},filterStatus:function(t){this.statusList=t.status,this.getBookList()},statusformat:function(t,e,r,a){var s=!0,o=!1,n=void 0;try{for(var l,c=i()(this.filteList);!(s=(l=c.next()).done);s=!0){var u=l.value;if(u.value==r)return u.text}}catch(t){o=!0,n=t}finally{try{!s&&c.return&&c.return()}finally{if(o)throw n}}},authorFormat:function(t,e,r,a){var s=[],o=!0,n=!1,l=void 0;try{for(var c,u=i()(t.authorList);!(o=(c=u.next()).done);o=!0){var d=c.value;s.push(d.name)}}catch(t){n=!0,l=t}finally{try{!o&&u.return&&u.return()}finally{if(n)throw l}}return s.join(" ")},dateFormat2:function(t,e,r,a){if(r)return r.split(" ")[0]},dateFormat:function(t,e,r,a){if(r)return r.split("-")[0]+"年"+r.split("-")[1]+"月"},updateTimeFormat:function(t,e,r,a){if(r)return r.split(" ")[0]},handleSelectionChange:function(t){if(this.multipleSelection=t,this.ids=[],this.multipleSelection.length>0){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(this.multipleSelection);!(e=(s=o.next()).done);e=!0){var n=s.value;this.ids.push(n.id)}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}}},handleCurrentChange:function(t){this.curPage=t,this.getBookList()},myPageChange:function(t){this.curPage=t,this.getBookList()},publishBook:function(t){var e=this.multipleSelection;if(0!=e.length){var r=!0,a=!1,s=void 0;try{for(var o,n=i()(e);!(r=(o=n.next()).done);r=!0){if(7!=+o.value.status)return void this.$message.error("该篇章已发布，不可重复发布")}}catch(t){a=!0,s=t}finally{try{!r&&n.return&&n.return()}finally{if(a)throw s}}var l=this;l.$http({method:"post",url:"/admin/cms/articleresource/publish",data:l.ids,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code&&(l.$message.success("发布成功！"),l.getBookList())})}else this.$message.error("请先选择数据！")},cancelPublish:function(){var t=this.multipleSelection;if(0!=t.length){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(t);!(e=(s=o.next()).done);e=!0){if(6!=s.value.status)return void this.$message.error("请选择状态为已发布的数据！")}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}var n=this;n.$http({method:"post",url:"/admin/cms/articleresource/exitpub",data:n.ids,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code&&(n.$message.success("取消发布成功！"),n.getBookList())})}else this.$message.error("请先选择数据！")},reviewBook:function(){var t=this.multipleSelection;if(0!=t.length){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(t);!(e=(s=o.next()).done);e=!0){var n=s.value;if(2!=n.status&&3!=n.status)return void this.$message.error("请选择状态为编辑中/退回编辑的数据！");if(n.editUserId!=this.userInfo.userId)return void this.$message.error("你无权进行此操作！")}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}var l=this;l.$http({method:"post",url:"/admin/cms/articleresource/submit",data:l.ids,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code&&(l.$message.success("提交审核成功！"),l.getBookList())})}else this.$message.error("请先选择数据！")},bookPass:function(){var t=this.multipleSelection;if(0!=t.length){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(t);!(e=(s=o.next()).done);e=!0){if(4!=s.value.status)return void this.$message.error("请选择状态为编辑中的数据！")}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}var n=this;n.$http({method:"post",url:"/admin/cms/articleresource/pass",data:n.ids,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code&&(n.$message.success("审核通过！"),n.getBookList())})}else this.$message.error("请先选择数据！")},returnEditor:function(){var t=this.multipleSelection;if(0!=t.length){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(t);!(e=(s=o.next()).done);e=!0){if(4!=s.value.status)return void this.$message.error("请选择状态为审核中的数据！")}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}var n=this;n.$http({method:"post",url:"/admin/cms/articleresource/nopass",data:n.ids,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code&&(n.$message.success("退回编辑通过！"),n.getBookList())})}else this.$message.error("请先选择数据！")},bookAllocation:function(){if(""!=this.editor){var t=this;t.$http({method:"post",url:"/admin/cms/articleresource/allocation",data:{ids:t.ids,userID:t.editor},transformRequest:[function(t){var e="";for(var r in t)e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){0==e.data.code&&(t.dialog=!1,t.$message.success("分配成功！"),t.getBookList())})}},allocationData:function(){var t=this.multipleSelection;if(0!=t.length){var e=!0,r=!1,a=void 0;try{for(var s,o=i()(t);!(e=(s=o.next()).done);e=!0){if(1!=s.value.status)return void this.$message.error("请选择初稿分配！")}}catch(t){r=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw a}}this.dialog=!0}else this.$message.error("请先选择数据！")},update:function(t){"chapter"==this.curType&&this.$router.push({path:"/main/chaperArticalManage/addArtical",query:{addOredite:"1",type:this.curType,id:t.id}}),"article"==this.curType&&this.$router.push({path:"/main/articalManage/addArtical",query:{addOredite:"1",type:this.curType,id:t.id}}),"report"==this.curType&&this.$router.push({path:"/main/reportList/addReport",query:{addOredite:"1",type:this.curType,id:t.id}}),"paper"==this.curType&&this.$router.push({path:"/main/paperList/addPaper",query:{addOredite:"1",type:this.curType,id:t.id}})},lookMsg:function(t){"chapter"==t.displayResourceType&&this.$router.push({path:"/main/chaperArticalManage/articleMsg",query:{addOredite:"1",type:this.curType,id:t.id}}),"report"==t.displayResourceType&&this.$router.push({path:"/main/reportList/reportMsg",query:{addOredite:"1",type:this.curType,id:t.id}}),"paper"==t.displayResourceType&&this.$router.push({path:"/main/paperList/paperMsg",query:{addOredite:"1",type:this.curType,id:t.id}})},sortbydate:function(t,e,r){this.sidx=t.prop,this.order="ascending"==t.order?"asc":"desc",this.getBookList()},getBookList:function(){var t=this;t.loading=!0,t.$http({method:"get",url:"/admin/cms/articleresource/list",params:{page:t.curPage,limit:t.limit,resourceTypeCodeList:"article",typeCode:t.curType,statusList:t.statusList.join(","),title:t.searchWord,source:t.sourceArticle,isbn:t.isbn,author:t.author,type:t.sourceType,startDate:t.startDate,endDate:t.endDate,sidx:t.sidx,order:t.order,editor:t.roler},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){0==e.data.code&&(t.total=e.data.page.totalCount,t.bookList=e.data.page.list),t.loading=!1})},getUserMsg:function(){var t=this;t.$http({method:"get",url:"/admin/sys/user/info?_"+(new Date).getTime(),headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.userInfo=e.data.user})},getEditorList:function(){var t=this;t.$http({method:"get",url:"/admin/cms/bookresource/editors",headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.editorList=e.data.users})},init:function(){this.curType=this.$route.meta.type,this.holdText="请输入"+this.typeCodeName[this.curType]+"标题",this.getBookList(),this.getUserMsg(),this.getEditorList(),this.getResourceOrderList()}},created:function(){this.init()}},n={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"rt_cont"},[r("div",{staticStyle:{padding:"10px 0",background:"#F0F2F5"}},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/main/adminManageHome"}}},[t._v("首页")]),t._v(" "),r("el-breadcrumb-item",[t._v(t._s(t.typeCodeName[t.curType])+"管理")])],1)],1),t._v(" "),r("div",{staticClass:"nrgl"},[r("div",{staticClass:"btnhandle"},[r("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.roler,callback:function(e){t.roler=e},expression:"roler"}},[r("el-tab-pane",{attrs:{name:"all"}},[r("span",{staticStyle:{"font-size":"16px","font-weight":"600"},attrs:{slot:"label"},slot:"label"},[t._v("全部")]),t._v(" "),r("div",{staticClass:"handle"},[(t.curType,r("el-button-group",{staticClass:"btbg"},[r("el-button",{attrs:{type:"primary",plain:""},on:{click:t.publishBook}},[t._v("上架")]),t._v(" "),r("el-button",{attrs:{type:"primary",plain:""},on:{click:t.cancelPublish}},[t._v("下架")]),t._v(" "),r("el-button",{attrs:{type:"primary",plain:""},on:{click:t.isAddResource}},[t._v("加入资源单")])],1))],1),t._v(" "),r("loading-tip",{attrs:{"show-load":t.loading}}),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"table"},[r("el-table",{ref:"multipleTable",staticStyle:{"min-width":"1200px"},attrs:{data:t.bookList,"tooltip-effect":"dark"},on:{"filter-change":t.filterStatus,"sort-change":t.sortbydate,"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"30"}}),t._v(" "),r("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),r("el-table-column",{attrs:{prop:"title",label:"标题","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[r("a",{staticClass:"hover_color",domProps:{innerHTML:t._s(e.row.title)},on:{click:function(r){t.lookMsg(e.row)}}})]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"source",label:"所属图书",width:"260","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[r("router-link",{staticClass:"hover_color",attrs:{to:{path:"/main/bookManage/addResource",query:{addOredite:"1",type:"book",id:e.row.bookResourceId}}},domProps:{innerHTML:t._s(e.row.source)}},[t._v(t._s(e.row.source))])]}}])}),t._v(" "),r("el-table-column",{staticClass:"filttb",attrs:{prop:"status",label:"状态",filters:t.filteList,"column-key":"status","filter-method":t.filterTag,formatter:t.statusformat,width:"86"}}),t._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"入库日期",formatter:t.dateFormat2,width:"90"}}),t._v(" "),r("el-table-column",{attrs:{prop:"publishDate",label:"出版日期",formatter:t.dateFormat,width:"90"}}),t._v(" "),r("el-table-column",{attrs:{prop:"updateTime",label:"更新日期",formatter:t.updateTimeFormat,sortable:!0,width:"100"}}),t._v(" "),r("el-table-column",{attrs:{prop:"lastEditor",label:"最后编辑人",width:"100"}}),t._v(" "),r("el-table-column",{attrs:{label:"操作",width:"120px",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("div",[r("a",{staticStyle:{color:"#409EFF"},on:{click:function(r){t.update(e.row)}}},[t._v("修改")]),t._v(" "),r("span",[t._v("|")]),t._v(" "),r("a",{staticStyle:{color:"#409EFF"},on:{click:function(r){t.lookDetail(e.row)}}},[t._v("阅读全文")])])]}}])})],1),t._v(" "),r("div",{staticClass:"page"},[r("div",{staticClass:"fr"},[r("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next, jumper","page-size":t.limit,"current-page":t.curPage,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.curPage=e}}})],1)])],1)],1)],1),t._v(" "),r("div",{staticClass:"upldbtn"},[r("el-input",{staticClass:"inputsc bknameInput",attrs:{size:"mini",placeholder:t.holdText},model:{value:t.searchWord,callback:function(e){t.searchWord=e},expression:"searchWord"}}),t._v(" "),r("el-input",{staticClass:"inputsc bknameInput",attrs:{size:"mini",placeholder:"请输入所属图书名称"},model:{value:t.sourceArticle,callback:function(e){t.sourceArticle=e},expression:"sourceArticle"}}),t._v(" "),r("el-date-picker",{staticClass:"inputsc ",attrs:{size:"mini",type:"date",placeholder:"出版日期",format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd"},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}}),t._v(" "),r("span",[t._v("至")]),t._v(" "),r("el-date-picker",{staticClass:"inputsc",attrs:{size:"mini",type:"date",placeholder:"出版日期",format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}}),t._v(" "),r("a",{staticClass:"aBtn",on:{click:function(e){t.getBookList(1)}}},[t._v("搜索")]),t._v(" "),r("a",{staticClass:"aBtn aBtnCancle ",on:{click:t.clear}},[t._v("重置")])],1),t._v(" "),r("el-dialog",{attrs:{title:"提示",visible:t.dialog,width:"30%"},on:{"update:visible":function(e){t.dialog=e}}},[r("span",[t._v("请选择编辑：")]),t._v(" "),r("el-select",{attrs:{placeholder:"请选择"},model:{value:t.editor,callback:function(e){t.editor=e},expression:"editor"}},t._l(t.editorList,function(t){return r("el-option",{key:t.userId,attrs:{label:t.username,value:t.userId}})})),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialog=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.bookAllocation}},[t._v("确 定")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:t.popTitle,visible:t.resourceTip,width:"30%"},on:{"update:visible":function(e){t.resourceTip=e}}},[r("div",{staticClass:"add",staticStyle:{"margin-top":"-30px"}},[r("p",{staticStyle:{margin:"15px 0"}},[t._v(" 书单名称: "),r("a",{directives:[{name:"show",rawName:"v-show",value:!t.isNewCreate,expression:"!isNewCreate"}],staticClass:"newOrder fr",on:{click:function(e){t.isNewCreate=!0}}},[t._v("新建书单")]),r("a",{directives:[{name:"show",rawName:"v-show",value:t.isNewCreate,expression:"isNewCreate"}],staticClass:"newOrder fr",on:{click:function(e){t.isNewCreate=!1}}},[t._v("取消")])]),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isNewCreate,expression:"!isNewCreate"}]},[r("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},model:{value:t.resourceOrderId,callback:function(e){t.resourceOrderId=e},expression:"resourceOrderId"}},t._l(t.resourceList,function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewCreate,expression:"isNewCreate"}]},[r("el-input",{attrs:{size:"mini",placeholder:"请输入内容"},model:{value:t.newOrder.name,callback:function(e){t.$set(t.newOrder,"name",e)},expression:"newOrder.name"}}),t._v(" "),r("p",{staticStyle:{margin:"10px 0"}},[t._v("书单说明：")]),t._v(" "),r("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:t.newOrder.abstracts,callback:function(e){t.$set(t.newOrder,"abstracts",e)},expression:"newOrder.abstracts"}})],1)]),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("div",{staticStyle:{"text-align":"center"}},[r("a",{staticClass:"aBtn aBtnCancle",on:{click:function(e){t.resourceTip=!1}}},[t._v("取 消")]),t._v(" "),r("a",{staticClass:"aBtn",on:{click:t.saveOrAdd}},[t._v("确 定")])])])])],1)])])},staticRenderFns:[]};var l=r("VU/8")(o,n,!1,function(t){r("lJ2O")},"data-v-3579ff80",null);e.default=l.exports},lJ2O:function(t,e){}});