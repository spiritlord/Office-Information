webpackJsonp([6],{"3kwG":function(e,t){},OLbV:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("BO1k"),i=s.n(r),a={name:"resourceOrderDetaile",data:function(){return{isEdite:!1,orderId:"",orderList:[],multipleSelection:[],searchdate:[],typeCodeName:[{text:"皮书",value:"book2"}],statusList:[{text:"草稿",value:"1"},{text:"已提交",value:"2"},{text:"待发布",value:"3"},{text:"发布中",value:"4"},{text:"成功",value:"5"},{text:"审核未通过",value:"6"}],idList:[],resorceCounte:"",dialogVisible:!1,newPrice:"",errorPrice:!1}},watch:{$route:"init"},methods:{lookDetail:function(e){"book"==e.resourceTypeCode?this.$router.push({path:"/index/bookDetail",query:{id:e.id,type:e.resourceTypeCode}}):this.$router.push({path:"/index/frontArticleDetail",query:{id:e.id,type:e.resourceTypeCode}})},handleSelectionChange:function(e){this.multipleSelection=e,this.idList=[];var t=!0,s=!1,r=void 0;try{for(var a,o=i()(this.multipleSelection);!(t=(a=o.next()).done);t=!0){var l=a.value;this.idList.push(l.id)}}catch(e){s=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(s)throw r}}},dateFormat:function(e,t,s,r){if(s&&""!=s)return s.split("-")[0]+"年"+s.split("-")[1]+"月"},showDialog:function(){this.dialogVisible=!0,this.errorPrice=!1,this.newPrice=this.orderList.price},batchDel:function(){0!=this.multipleSelection.length?this.delOrder():this.$message({message:"请先选择数据！",type:"error"})},delOneDate:function(e){this.idList=[],this.idList.push(e.id),this.delOrder()},updatePrice:function(){var e=this;/^[0-9]*$/.test(e.newPrice)?e.$http({method:"post",url:"/admin/cms/resourcelist/update",data:{id:e.orderId,price:e.newPrice},headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){0==t.data.code&&(e.$message.success("修改成功！"),e.getMyOrder(),e.dialogVisible=!1)}):e.errorPrice=!0},delOrder:function(){var e=this;e.$http({method:"post",url:"/admin/cms/resourcelist/removeResource",data:{resourceOrderId:e.orderId,resourceIds:e.idList},transformRequest:[function(e){var t="";for(var s in e)t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s])+"&";return t}],headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){0==t.data.code&&(e.$message.success("删除成功！"),e.getMyOrder())})},getMyOrder:function(){var e=this;e.$http({method:"get",url:"/admin/cms/resourcelist/info/"+e.orderId,headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){0==t.data.code&&(e.orderList=t.data.resourceList,e.resorceCounte=e.orderList.resourceList?e.orderList.resourceList.length:0)})},updateDescrip:function(){this.isEdite&&this.$http({method:"post",url:"/admin/cms/resourcelist/updateResource",params:{resourceListId:this.orderId,abstracts:this.orderList.abstracts},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){e.data.code})},submitOrder:function(){var e=this;e.$http({method:"post",url:"/admin/cms/resourcelist/submit",data:[e.orderList.id],headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code?(e.$router.push({path:"/main/resourcePublish",query:{type:"1"}}),e.$message.success("提交成功！"),e.getMyOrder()):e.$message({type:"error",dangerouslyUseHTMLString:!0,message:t.data.msg})})},egisThrough:function(){var e=this;e.$http({method:"post",url:"/admin/cms/resourcelist/pass",data:[e.orderList.id],headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code?(e.$message.success("审核通过！"),e.getMyOrder()):e.$message({type:"error",dangerouslyUseHTMLString:!0,message:t.data.msg})})},init:function(e,t){this.isEdite=0!=this.$route.query.type,this.isShowPrice=0!=this.$route.query.editorPrice,this.orderId=this.$route.query.id,this.getMyOrder()}},created:function(){this.init()}},o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"rt_cont"},[s("div",{staticStyle:{padding:"10px 0",background:"#F0F2F5"}},[s("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/main/adminManageHome"}}},[e._v("首页")]),e._v(" "),s("el-breadcrumb-item",[e._v("内容发布管理")])],1)],1),e._v(" "),s("div",{staticClass:"nrgl"},[s("div",{staticClass:"btnhandle"},[s("h5",{staticClass:"pagett"},[e._v("资源单详情")]),e._v(" "),s("div",{staticClass:"orderMsg"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"msgiterm1"},[e._v("创建日期："+e._s(e.orderList.createTime))]),e._v(" "),s("div",{staticClass:"msgiterm1"},[e._v("资源总数： "+e._s(e.resorceCounte))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"msgiterm2"},[s("p",[e._v("提交日期："+e._s(e.orderList.submitTime))]),e._v(" "),s("p",[e._v("总价："),s("span",[e._v("￥"+e._s(e.orderList.price))])])])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"msgiterm3 fr"},[s("p",[e._v("发布日期："+e._s(e.orderList.publishTime))]),e._v(" "),s("p",[e._v("原总价：￥"+e._s(e.orderList.discountPrice))])])])],1)],1),e._v(" "),s("div",{staticClass:"descripe"},[s("p",{staticClass:"resourceMsg"},[e._v("资源单说明")]),e._v(" "),s("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",readonly:!e.isEdite},on:{blur:e.updateDescrip},model:{value:e.orderList.abstracts,callback:function(t){e.$set(e.orderList,"abstracts",t)},expression:"orderList.abstracts"}})],1),e._v(" "),s("div",{staticClass:"table"},[s("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.orderList.resourceList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[e.isEdite?s("el-table-column",{attrs:{type:"selection",width:"55"}}):e._e(),e._v(" "),s("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"类型",width:"60"}}),e._v(" "),s("el-table-column",{attrs:{prop:"title",label:"资源名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{staticStyle:{color:"#606266"},on:{click:function(s){e.lookDetail(t.row)}}},[e._v(e._s(t.row.title))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"source",label:"所属图书","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"isbn",label:"ISBN",width:"160"}}),e._v(" "),s("el-table-column",{attrs:{prop:"authors",label:"作者",width:"160","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"discountPrice",label:"单价",width:"80"}}),e._v(" "),s("el-table-column",{attrs:{prop:"publishDate",label:"出版时间",width:"100",formatter:e.dateFormat}}),e._v(" "),e.isEdite?s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{staticStyle:{color:"#409EFF"},on:{click:function(s){e.delOneDate(t.row)}}},[e._v("删除")])]}}])}):e._e()],1)],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isEdite,expression:"isEdite"}],staticClass:"upldbtn"},[s("el-row",{staticClass:"btnrow fr"},[s("a",{staticClass:"aBtn aBtnCancle",on:{click:e.batchDel}},[e._v("批量删除")]),e._v(" "),s("a",{directives:[{name:"show",rawName:"v-show",value:2==e.orderList.status,expression:"orderList.status==2"}],staticClass:"aBtn",on:{click:e.showDialog}},[e._v("修改价格")]),e._v(" "),s("a",{directives:[{name:"show",rawName:"v-show",value:1==e.orderList.status,expression:"orderList.status==1"}],staticClass:"aBtn",on:{click:e.submitOrder}},[e._v("提交审核")]),e._v(" "),s("a",{directives:[{name:"show",rawName:"v-show",value:2==e.orderList.status,expression:"orderList.status==2"}],staticClass:"aBtn",on:{click:e.egisThrough}},[e._v("审核通过")])])],1),e._v(" "),s("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"420px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"dialog"},[e._v("\n              总价："),s("el-input",{staticStyle:{width:"330px"},attrs:{size:"small",placeholder:"请输入内容"},model:{value:e.newPrice,callback:function(t){e.newPrice=t},expression:"newPrice"}}),e._v(" "),s("span",{staticClass:"unit"},[e._v("￥")]),e._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:e.errorPrice,expression:"errorPrice"}],staticStyle:{color:"#EE3B3B",padding:"5px 0 0 45px"}},[e._v("价格设置有误，请重新设置！")])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("a",{staticClass:"aBtn aBtnCancle",on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),s("a",{staticClass:"aBtn",on:{click:e.updatePrice}},[e._v("确 定")])])])],1)])])},staticRenderFns:[]};var l=s("VU/8")(a,o,!1,function(e){s("3kwG")},"data-v-3b02a072",null);t.default=l.exports}});