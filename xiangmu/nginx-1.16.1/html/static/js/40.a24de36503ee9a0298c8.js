webpackJsonp([40],{J71Q:function(t,e){},S69x:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("BO1k"),s=i.n(a),r={name:"resourcePublish",data:function(){return{loading:!1,newOrder:{},resourceList:[],multipleSelection:[],idList:[],curPage:1,isshow:!1,fileList:[],startDate:"",endDate:"",statusList:[{text:"已提交",value:"2"},{text:"待发布",value:"3"},{text:"发布中",value:"4"},{text:"已发布",value:"5"},{text:"审核未通过",value:"6"}],resourced:"",status:[],total:1,title:"",sidx:"createTime",order:"desc",popName:"",publishData:!1,fileType:[],bookTypeList:["pdf","word","txt","xml","epub","mobi"],artTypeList:["pdf","word","txt"],checkAll:!1,waterMark:"",orderList:[],checkList:{resourceOrderId:"",water:"1",typeList:[]}}},watch:{$route:"init"},components:{loadingTip:i("T8Lg").a},methods:{handleCheckAllChange:function(t){this.fileType=t?this.bookTypeList:[];var e=!0,i=!1,a=void 0;try{for(var r,l=s()(this.orderList.resourceList);!(e=(r=l.next()).done);e=!0){var o=r.value;o.collectionId=t,t?("社内图书"==o.type&&(o.editorList=this.bookTypeList),"篇章"==o.type&&(o.editorList=this.artTypeList)):o.editorList=[]}}catch(t){i=!0,a=t}finally{try{!e&&l.return&&l.return()}finally{if(i)throw a}}},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.bookTypeList.length;var i=!0,a=!1,r=void 0;try{for(var l,o=s()(this.orderList.resourceList);!(i=(l=o.next()).done);i=!0){var n=l.value;n.collectionId=this.checkAll,n.editorList=t}}catch(t){a=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}},tableCheckAllChange:function(t){t.collectionId?("社内图书"==t.type&&(t.editorList=this.bookTypeList),"篇章"==t.type&&(t.editorList=this.artTypeList)):t.editorList=[]},tableCheckboxChange:function(t){"社内图书"==t.type&&(t.collectionId=t.editorList.length==this.bookTypeList.length),"篇章"==t.type&&(t.collectionId=t.editorList.length==this.artTypeList.length)},reset:function(){this.title="",this.curPage=1,this.startDate="",this.endDate="",this.getPublishList()},handleSelectionChange:function(t){this.multipleSelection=t,this.idList=[];var e=!0,i=!1,a=void 0;try{for(var r,l=s()(this.multipleSelection);!(e=(r=l.next()).done);e=!0){var o=r.value;this.idList.push(o.id)}}catch(t){i=!0,a=t}finally{try{!e&&l.return&&l.return()}finally{if(i)throw a}}},handleCurrentChange:function(t){this.curPage=t,this.getPublishList()},searchDuringDate:function(){this.curPage=1,this.getPublishList()},godtl:function(t,e){this.$router.push({path:"/main/resourcePublish/resourceOrderDetaile",query:{id:e.id,type:0}})},filterTag:function(t,e,i){return!0},download:function(t,e){window.open("/admin/cms/resourcelist/downLoadResource?resourceOrderId="+e.id)},filterStatus:function(t){this.status=t.status,this.getPublishList()},tbformat:function(t,e,i,a){var r=!0,l=!1,o=void 0;try{for(var n,c=s()(this.statusList);!(r=(n=c.next()).done);r=!0){var d=n.value;if(d.value==i)return d.text}}catch(t){l=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(l)throw o}}},updateTimeFormat:function(t,e,i,a){if(i)return i.split(" ")[0]},getOrderList:function(){if(0!=this.multipleSelection.length)if(1==this.multipleSelection.length){var t=!0,e=!1,i=void 0;try{for(var a,r=s()(this.multipleSelection);!(t=(a=r.next()).done);t=!0){var l=a.value;if(3!=l.status&&6!=l.status)return void(5==l.status?this.$message.error("此资源单已发布，不可重复发布"):this.$message.error("请选择待发布或发布失败的数据！"))}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}var o=this,n=o.multipleSelection[0].id;o.publishData=!o.publishData,o.$http({method:"get",url:"/admin/cms/resourcelist/info/"+n,headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){0==t.data.code&&(o.orderList=t.data.resourceList)})}else this.$message.error("只能选择一条资源！");else this.$message.error("请先选择资源！")},publishOrder:function(){var t=this;t.$http({method:"post",url:"/admin/cms/resourcelist/publish",data:t.checkList,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){0==e.data.code?(t.$message.success("发布成功！"),t.getPublishList(),t.publishData=!1):t.$message.error(e.data.msg)})},checkedDataHandle:function(){for(var t=0;t<this.orderList.resourceList.length;t++){this.checkList.resourceOrderId=this.orderList.id;var e=this.orderList.resourceList[t],i={};if(0==(i=e.collectionId?{resourceId:e.id,types:["all"]}:{resourceId:e.id,types:e.editorList}).types.length)return;this.checkList.typeList[t]=i}this.publishOrder()},egisThrough:function(){if(0!=this.multipleSelection.length){var t=!0,e=!1,i=void 0;try{for(var a,r=s()(this.multipleSelection);!(t=(a=r.next()).done);t=!0){if(2!=a.value.status)return void this.$message.error("只能选择状态为已提交的数据！")}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}var l=this;l.$http({method:"post",url:"/admin/cms/resourcelist/pass",data:l.idList,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code?(l.$message.success("审核通过！"),l.getPublishList()):l.$message({type:"error",dangerouslyUseHTMLString:!0,message:t.data.msg})})}else this.$message.error("请选择一条数据")},refuseThrough:function(){if(0!=this.multipleSelection.length){var t=!0,e=!1,i=void 0;try{for(var a,r=s()(this.multipleSelection);!(t=(a=r.next()).done);t=!0){if(2!=a.value.status)return void this.$message.error("只能选择状态为已提交的数据！")}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}var l=this;l.$http({method:"post",url:"/admin/cms/resourcelist/notpass",data:l.idList,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){0==t.data.code?(l.$message.success("审核不通过，操作成功！"),l.getPublishList()):l.$message({type:"error",dangerouslyUseHTMLString:!0,message:t.data.msg})})}else this.$message.error("请选择一条数据")},editeOrder:function(){if(1==this.multipleSelection.length){var t=!0,e=!1,i=void 0;try{for(var a,r=s()(this.multipleSelection);!(t=(a=r.next()).done);t=!0){if(2!=a.value.status)return void this.$message({message:"只有提交状态的资源单可以修改！",type:"error"})}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}this.$router.push({path:"/main/resourcePublish/resourceOrderDetaile",query:{id:this.multipleSelection[0].id,type:1,editorPrice:1}})}else this.$message({message:"请先选择一条数据！",type:"error"})},getPublishList:function(){var t=this;t.loading=!0,t.$http({method:"get",url:"/admin/cms/resourcelist/list",params:{title:t.title,statusList:t.status.join(","),startDate:""==t.startDate?null:t.startDate,endDate:""==t.endDate?null:t.endDate,page:t.curPage,limit:12,sidx:t.sidx,order:t.order},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){0==e.data.code&&(t.resourceList=e.data.page.records,t.total=e.data.page.total),t.loading=!1})},init:function(){this.getPublishList()}},created:function(){this.init()}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rt_cont"},[i("div",{staticStyle:{padding:"10px 0",background:"#F0F2F5"}},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/main/adminManageHome"}}},[t._v("首页")]),t._v(" "),i("el-breadcrumb-item",[t._v("内容发布管理")])],1)],1),t._v(" "),i("div",{staticClass:"nrgl"},[i("div",{staticClass:"btnhandle"},[i("h5",{staticClass:"pagett"},[t._v("资源发布管理")]),t._v(" "),i("div",{staticStyle:{position:"relative"}},[i("el-button-group",{staticClass:"btbg"},[i("el-button",{staticClass:"updatebtn",attrs:{type:"primary",plain:""},on:{click:t.editeOrder}},[t._v("修改资源单")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:t.egisThrough}},[t._v("审核通过")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:t.refuseThrough}},[t._v("审核不通过")])],1),t._v(" "),i("div",{staticClass:"btnHover",attrs:{type:"primary",size:"mini",plain:""}},[i("el-dropdown",[i("span",{staticClass:"el-dropdown-link"},[t._v("\n                          发布资源单")]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[t._v("数据库")]),t._v(" "),i("el-dropdown-item",{nativeOn:{click:function(e){return t.getOrderList(e)}}},[t._v("个人")])],1)],1)],1)],1),t._v(" "),i("loading-tip",{attrs:{"show-load":t.loading}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"table"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.resourceList,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange,"filter-change":t.filterStatus}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{prop:"id",label:"资源单编号"}}),t._v(" "),i("el-table-column",{attrs:{prop:"name",label:"资源单名"}}),t._v(" "),i("el-table-column",{attrs:{prop:"price",label:"价格",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{prop:"status",label:"状态",width:"120",filters:t.statusList,"column-key":"status","filter-method":t.filterTag,formatter:t.tbformat}}),t._v(" "),i("el-table-column",{attrs:{prop:"propStr",label:"申请人员",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{prop:"submitTime",label:"提交日期",formatter:t.updateTimeFormat,width:"120"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("a",{staticStyle:{color:"#409EFF"},on:{click:function(i){t.godtl(e.$index,e.row)}}},[t._v("查看")]),4==e.row.status||5==e.row.status?i("span",[t._v(" | "),i("a",{staticStyle:{color:"#409EFF"},attrs:{href:"/admin/cms/resourcelist/downLoadResource?resourceOrderId="+e.row.id}},[t._v("下载")])]):t._e()]}}])})],1),t._v(" "),i("div",{staticClass:"page"},[i("div",{staticClass:"fr"},[i("el-pagination",{attrs:{background:"","current-page":t.curPage,"page-size":12,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.curPage=e}}})],1)]),t._v(" "),i("el-dialog",{attrs:{title:"数据发布",visible:t.publishData,width:"70%"},on:{"update:visible":function(e){t.publishData=e}}},[i("div",{staticClass:"dialogFooter"},[i("a",{staticClass:"aBtn",on:{click:t.checkedDataHandle}},[t._v("发布")])]),t._v(" "),i("div",{staticClass:"dialogcont"},[i("div",{staticClass:"typeList"},[i("div",{staticClass:"fileType"},[t._v("\n                          选择文件格式：\n                          "),i("el-checkbox",{staticStyle:{"margin-right":"0px"},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全部")]),t._v(" "),i("el-checkbox-group",{staticClass:"boxGroup",on:{change:t.handleCheckedCitiesChange},model:{value:t.fileType,callback:function(e){t.fileType=e},expression:"fileType"}},t._l(t.bookTypeList,function(e){return i("el-checkbox",{key:e,staticStyle:{"margin-right":"10px"},attrs:{label:e}},[t._v(t._s(e))])}))],1),t._v(" "),i("div",{staticClass:"fileType"},[t._v("\n                          是否添加水印：\n                          "),i("el-radio-group",{model:{value:t.checkList.water,callback:function(e){t.$set(t.checkList,"water",e)},expression:"checkList.water"}},[i("el-radio",{attrs:{label:"1"}},[t._v("是")]),t._v(" "),i("el-radio",{attrs:{label:"0"}},[t._v("否")])],1)],1)]),t._v(" "),i("div",{staticStyle:{"padding-top":"15px"}},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:t.orderList.resourceList,"tooltip-effect":"dark"}},[i("el-table-column",{attrs:{prop:"title",label:"资源名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"isbn",label:"ISBN",width:"160","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:"类型",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"格式选择",width:"510"},scopedSlots:t._u([{key:"default",fn:function(e){return["图书"==e.row.type?i("el-checkbox",{staticStyle:{"margin-right":"0px"},on:{change:function(i){t.tableCheckAllChange(e.row)}},model:{value:e.row.collectionId,callback:function(i){t.$set(e.row,"collectionId",i)},expression:"scope.row.collectionId"}},[t._v("全书")]):t._e(),t._v(" "),"图书"==e.row.type?i("el-checkbox-group",{staticClass:"boxGroup tableBoxGroup",on:{change:function(i){t.tableCheckboxChange(e.row)}},model:{value:e.row.editorList,callback:function(i){t.$set(e.row,"editorList",i)},expression:"scope.row.editorList"}},t._l(t.bookTypeList,function(e){return i("el-checkbox",{key:e,staticStyle:{"margin-right":"10px"},attrs:{label:e}},[t._v(t._s(e))])})):t._e(),t._v(" "),"图书"!=e.row.type?i("el-checkbox",{staticStyle:{"margin-right":"0px"},on:{change:function(i){t.tableCheckAllChange(e.row)}},model:{value:e.row.collectionId,callback:function(i){t.$set(e.row,"collectionId",i)},expression:"scope.row.collectionId"}},[t._v("全部")]):t._e(),t._v(" "),"图书"!=e.row.type?i("el-checkbox-group",{staticClass:"boxGroup tableBoxGroup",on:{change:function(i){t.tableCheckboxChange(e.row)}},model:{value:e.row.editorList,callback:function(i){t.$set(e.row,"editorList",i)},expression:"scope.row.editorList"}},t._l(t.artTypeList,function(e){return i("el-checkbox",{key:e,staticStyle:{"margin-right":"10px"},attrs:{label:e}},[t._v(t._s(e))])})):t._e()]}}])})],1)],1)])])],1),t._v(" "),i("div",{staticClass:"upldbtn"},[i("el-row",{staticClass:"btnrow fr"},[i("el-input",{staticStyle:{width:"280px"},attrs:{size:"mini",placeholder:"请输入资源单名称"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),i("el-date-picker",{staticClass:"inputsc",attrs:{size:"mini",type:"date",placeholder:"提交起始日期",format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd"},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}}),t._v(" "),i("span",[t._v("至")]),t._v(" "),i("el-date-picker",{staticClass:"inputsc",attrs:{size:"mini",type:"date",placeholder:"提交截止日期",format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}}),t._v(" "),i("a",{staticClass:"aBtn",on:{click:t.searchDuringDate}},[t._v("搜索")]),t._v(" "),i("a",{staticClass:"aBtn aBtnCancle",on:{click:t.reset}},[t._v("重置")])],1)],1)],1)])])},staticRenderFns:[]};var o=i("VU/8")(r,l,!1,function(t){i("J71Q")},"data-v-665b75b2",null);e.default=o.exports}});