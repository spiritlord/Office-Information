webpackJsonp([24],{A9O4:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("BO1k"),i=a.n(s),l={name:"detailList",data:function(){return{detailList:[],total:"",statusList:[],checkedList:[],idList:[],filteList:[{text:"成功",value:"0"},{text:"失败",value:"1"}]}},props:["resourceId"],methods:{filterStatus:function(t){this.statusList=t.success,this.getList()},filterData:function(){return!0},statusFormat:function(t,e,a,s){return 1==t.status?"失败":"成功"},handleSelectionChange:function(t){this.checkedList=t,this.idList=[];var e=!0,a=!1,s=void 0;try{for(var l,o=i()(this.checkedList);!(e=(l=o.next()).done);e=!0){var n=l.value;this.idList.push(n.id)}}catch(t){a=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw s}}},downLoad:function(){this.idList.length>0&&document.getElementById("dld").click()},getList:function(){var t=this;t.$http({method:"get",url:"/admin/cms/resourceEntryDetailLog/list",params:{resourceId:t.resourceId,status:t.statusList.join(",")},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.detailList=e.data.list})}},created:function(){this.getList()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detailList"},[a("div",{staticClass:"exportPosition",on:{click:t.downLoad}},[a("a",{staticClass:"export"},[t._v("下载")]),a("i",{staticClass:"el-icon-download"})]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.detailList,"tooltip-effect":"dark"},on:{"filter-change":t.filterStatus,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{label:"序号",type:"index",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"resourceName",label:"资源名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"success",label:"状态",filters:t.filteList,"column-key":"success","filter-method":t.filterData,formatter:t.statusFormat,width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"result",label:"失败原因"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.row.status,expression:"scope.row.status==1"}],staticStyle:{color:"#606266"}},[t._v(t._s(e.row.result))])]}}])})],1),t._v(" "),a("a",{staticStyle:{display:"none"},attrs:{id:"dld",href:"/admin/cms/resourceEntryDetailLog/download/"+t.idList.join(",")}},[t._v("点击导出")])],1)},staticRenderFns:[]};var n={name:"resourceManage",data:function(){return{dataLoading:!1,storageWay:0,resourceType:0,storageWayType:0,activeName:"first",resourceList:[],multipleSelection:[],curPage:1,totalCount:1,limit:14,isshow:!1,fileList:[],loading:"",fileNum:"还没有选择文件",fileName:"",fileLoad:!1}},components:{detailList:a("VU/8")(l,o,!1,function(t){a("dL8D")},"data-v-5991ae4e",null).exports,loadingTip:a("T8Lg").a},mounted:function(){document.getElementsByClassName("el-tabs__content")[0].style.minHeight=document.body.clientHeight-220+50+"px"},methods:{exportResource:function(){this.isshow=!this.isshow,this.isshow||this.clearFile()},handleSelectionChange:function(t){this.multipleSelection=t},handleCurrentChange:function(t){this.curPage=t,this.getResourceEntry()},numFormat:function(t,e,a,s){return t.okNum+t.errorNum},getFileNum:function(){var t=document.getElementById("uploadFile").files;this.fileName=t[0].name,this.fileNum="已选择文件"},clearFile:function(){document.getElementById("uploadFile").value=[],this.fileNum="还没有选择文件"},submitUpload:function(){var t=this,e=document.getElementById("uploadFile").files,a=new FormData;if(0!=e.length){for(var s=0;s<e.length;s++)a.append("files",e[s]);a.append("resourceType",t.resourceType),a.append("storageMethod",t.storageWay),a.append("storageType",t.storageWayType),t.fileLoad=!0,t.$http({method:"post",url:"/admin/cms/resourceEntry/upload",data:a}).then(function(e){t.fileLoad=!1,t.$message.success("资源导入成功！"),t.getResourceEntry(),t.clearFile()}).catch(function(e){t.fileLoad=!1,t.$message.success("资源导入失败！")})}else t.$message.error("请先选择要上传的资源！")},getResourceEntry:function(){var t=this;t.dataLoading=!0,t.$http({method:"get",url:"/admin/cms/resourceEntry/list",params:{page:t.curPage,limit:t.limit,sidx:"createTime",order:"desc"},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.resourceList=e.data.page.list,t.totalCount=e.data.page.totalCount,t.dataLoading=!1})}},created:function(){this.getResourceEntry()}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"rt_cont"},[a("div",{staticStyle:{padding:"10px 0",background:"#F0F2F5"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/main/adminManageHome"}}},[t._v("首页")]),t._v(" "),a("el-breadcrumb-item",[t._v("资源入库管理")])],1)],1),t._v(" "),a("div",{staticClass:"nrgl"},[a("div",{staticClass:"btnhandle"},[a("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"first"}},[a("span",{staticStyle:{"font-size":"16px"},attrs:{slot:"label"},slot:"label"},[t._v("资源列表")]),t._v(" "),a("loading-tip",{attrs:{"show-load":t.dataLoading}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.dataLoading,expression:"!dataLoading"}],staticClass:"table"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.resourceList,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("detail-list",{attrs:{"resource-id":t.row.id}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"序号",type:"index",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:"名称",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{label:"总数",formatter:t.numFormat,width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"okNum",label:"成功数",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"errorNum",label:"失败数",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"时间",width:"170"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createUserName",label:"操作人",width:"150"}})],1),t._v(" "),a("div",{staticClass:"page"},[a("div",{staticClass:"fr"},[a("el-pagination",{attrs:{"current-page":t.curPage,"page-size":t.limit,total:t.totalCount,layout:"total, prev, pager, next, jumper",background:""},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.curPage=e}}})],1)])],1)],1)],1),t._v(" "),a("div",{staticClass:"upldbtn"},[a("a",{staticClass:"aBtn",on:{click:t.exportResource}},[t._v("导入")])])],1),t._v(" "),a("div",{staticClass:"pop",class:{showpop:t.isshow,hidepop:!t.isshow}},[a("div",{staticClass:"upldttl"},[t._v("\n            导入资源  "),a("div",{staticClass:"el-notification__closeBtn el-icon-close upclose",on:{click:t.exportResource}})]),t._v(" "),a("div",{staticClass:"type_iterm"},[a("div",{staticClass:"type_title"},[t._v("入库方式：")]),t._v(" "),a("el-radio-group",{model:{value:t.storageWay,callback:function(e){t.storageWay=e},expression:"storageWay"}},[a("el-radio",{attrs:{label:0}},[t._v("社内资源导入")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("社外资源导入")])],1)],1),t._v(" "),a("div",{staticClass:"type_iterm"},[a("div",{staticClass:"type_title"},[t._v("资源类型：")]),t._v(" "),a("el-radio-group",{model:{value:t.resourceType,callback:function(e){t.resourceType=e},expression:"resourceType"}},[a("el-radio",{attrs:{label:0}},[t._v("图书导入")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("文章导入")])],1)],1),t._v(" "),a("div",{staticClass:"type_iterm"},[a("div",{staticClass:"type_title"},[t._v("入库类型：")]),t._v(" "),a("el-radio-group",{model:{value:t.storageWayType,callback:function(e){t.storageWayType=e},expression:"storageWayType"}},[a("el-radio",{attrs:{label:0}},[t._v("SSAPXML")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("其他")])],1)],1),t._v(" "),a("div",{staticClass:"files"},[a("el-button",{attrs:{size:"small",plain:""}},[t._v("选择文件")]),a("span",{staticStyle:{"padding-left":"15px",color:"#666","font-size":"12px"}},[t._v(t._s(t.fileNum))]),t._v(" "),a("div",[t.fileLoad?a("a",{staticClass:"aBtn",staticStyle:{"margin-top":"20px"}},[a("i",{staticClass:"el-icon-loading"}),t._v("正在导入,请稍后....")]):a("a",{staticClass:"aBtn",staticStyle:{"margin-top":"20px"},on:{click:t.submitUpload}},[t._v("开始上传")])]),t._v(" "),a("input",{attrs:{id:"uploadFile",type:"file",name:"file"},on:{change:t.getFileNum}})],1)])])])},staticRenderFns:[]};var c=a("VU/8")(n,r,!1,function(t){a("AQOU")},"data-v-114ebc44",null);e.default=c.exports},AQOU:function(t,e){},dL8D:function(t,e){}});